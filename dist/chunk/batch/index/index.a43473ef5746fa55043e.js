(window.webpackJsonpso=window.webpackJsonpso||[]).push([[0],{44:function(t,a,e){"use strict";e.r(a);var n=e(59),o=e.n(n);for(var r in n)"default"!==r&&function(t){e.d(a,t,function(){return n[t]})}(r);var s=e(98),i=e(0),l=!1;var c=function(t){l||e(92)},u=Object(i.a)(o.a,s.a,s.b,!1,c,null,null);u.options.__file="src\\page\\bonus\\batch\\index.vue",a.default=u.exports},59:function(t,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n=s(e(15)),o=s(e(14)),r=s(e(94));function s(t){return t&&t.__esModule?t:{default:t}}function i(t){if(Array.isArray(t)){for(var a=0,e=Array(t.length);a<t.length;a++)e[a]=t[a];return e}return Array.from(t)}a.default={components:{Information:r.default},data:function(){return{maxMonth:new Date+7776e6,minMonth:new Date-7776e6,form:{bonusType:"",bonusTypeName:"",batchName:"",batchCode:"",deptId:"",deptName:"",grantStartMonth:"",grantEndMonth:"",startMonth:"",endMonth:"",monthShare:!1,multiSalary:!1,type:"",rewardName:"",rewardNameVal:"",salaryGroup:"",salaryGroupValue:""},spinShow:!1,dataId:"",downTemplate:[],table:{data:[],tableColumns1:[],totalNum:0,totalBonus:"0.0",percentage:"0%",uncoveringTotalNum:"",uncoveringTotalBonus:""},isImport:!1,grantStartMonthDatePicker:"",grantEndMonthDatePicker:"",SALARY_GROUP:[]}},computed:{actionUpload:function(){return"/sylla/phr-ui/bonus/import/start?"+this.formatForm()},isShowimport:function(){var t=this.table.data,a=!0;if(t.length>0)for(var e=0;e<t.length&&!t[e].error;e++)a=!1;return a},dateOptions3:function(t){var a=this;return{disabledDate:function(t){var e=a.form.grantEndMonth;return t&&t.valueOf()>new Date(e).valueOf()}}},dateOptions4:function(t){var a=this;return{disabledDate:function(t){var e=a.form.grantStartMonth;return t&&t.valueOf()<new Date(e).valueOf()-864e5}}},rewardNameVal:function(){var t=this.form;return this.form.rewardNameVal=t.deptName+"_"+t.batchName+"_"+t.bonusTypeName}},watch:{"form.deptId":function(t){this.clearTable(),this.form.deptName=this.getName(this.$store.state.batch.deptList,t)},"form.bonusType":function(t){this.clearTable();for(var a="",e=0;e<t.length;e++)a+=this.getName(this.$store.state.batch.typeitemInfo,t[e])+"_";a=a&&a.substring(a,a.length-1),this.form.bonusTypeName=a},"table.data":function(t){for(var a=0;a<t.length;a++){if(t[a].error){this.isImport=!1;break}this.isImport=!0}},"form.type":function(){this.clearTable()},"form.salaryGroup":function(t){this.form;var a=this.SALARY_GROUP,e={};return a&&a.map(function(a){t==a.value&&(e=a)}),this.form.salaryGroupValue=e.desc}},created:function(){this.$store.dispatch("getTypeitemInfo"),this.$store.dispatch("getDeptList"),this.getSALARY_GROUP()},methods:{salaryGroupChange:function(t){var a=this;n.default.accountedmaxyearmonth({value:t,success:function(t){0==t.status&&(a.grantStartMonthDatePicker=t.data||"",a.grantEndMonthDatePicker=t.data||"")},error:function(t){console.error(t)}})},getSALARY_GROUP:function(){var t=this;o.default.getDictionaries({type:"SALARY_GROUP",success:function(a){0==a.status&&(t.SALARY_GROUP=[].concat(i(a.data)))},error:function(t){console.error(t)}})},formCheckBox:function(){var t=this.form;return t.bonusType?t.batchName?t.deptId?t.salaryGroup?t.grantStartMonth&&"NaN-aN"!=t.grantStartMonth?t.grantEndMonth&&"NaN-aN"!=t.grantEndMonth?t.type?"":"下载模板":"发放结束月":"发放开始月":"薪资组":"部门":"归属期间":"奖金类型"},dateTimeOpenChange:function(t,a,e){if(t){var n=e||"";this.form[a]=n,"grantStartMonth"==a?n=this.form[a]<this.form.grantEndMonth?e:"":"grantEndMonth"==a&&(n=this.form.grantStartMonth>this.form[a]?"":e),this.form[a]=n}},clearTable:function(){var t=this.table;return t.data=[],t.tableColumns1=[],t.totalNum=0,t.totalBonus="0.00",t.percentage="0%",this.isImport=!1,t},importPreview:function(){var t=this.formCheckBox();if(t)return this.$Message.error({content:t+"不能为空"});var a=this.form,e=this,o=!0,r=a.rewardName?a.rewardNameVal+"_"+a.rewardName:""+a.rewardNameVal;n.default.batchnameCheck({batchName:r,success:function(t){0!==t.status&&(e.$Message.error(t.statusText),o=!1)}}),o&&e.$refs.upload.handleClick()},onProgress:function(){this.spinShow=!0},getName:function(t,a){var e="";if(a)for(var n=0;n<t.length;n++){if(a===t[n].value){e=t[n].label||t[n].text;break}var o=t[n].children||[];if(o.length>0)for(var r=0;r<o.length;r++)if(a===o[r].value){e=o[r].label||o[r].text;break}}return e},rowClassName:function(t){var a="";return t.waring?a="ff6600":t.error&&(a="demo-table-error-row"),a},bonustypebatchitemChange:function(t){this.clearTable(),t=t&&t[0],this.$store.dispatch("getBonustypebatchitem",t);var a=[{value:"7",label:"PM-季度/半年"},{value:"8",label:"PM-半年/全年"},{value:"9",label:"其他模板-人为指定"}],e=[];[{list:["otherBonus","seniorBonus","commisionBonus","businessBonus"],selectTemp:["9"]},{list:["quarterPM","monthPM","halfYearPM","yearPM"],selectTemp:["7","8","9"]}].map(function(a){a.list.includes(t)&&(e=[].concat(i(a.selectTemp)))});for(var n=[],o=0;o<a.length;o++)e.includes(a[o].value)&&n.push(a[o]);this.downTemplate=[].concat(n)},bonustypebatchitemInfoChange:function(t){this.clearTable();for(var a=this.$store.state.batch.typebatchitemInfo,e=0;e<a.length;e++)if(a[e].text===t){var n=a[e],o=(n.sugText&&n.sugText.split("-"),n.value&&n.value.split("-"));this.form.batchCode=n.value,this.form.startMonth=this.valCheck(o[0]),this.form.endMonth=this.valCheck(o[1]);break}},valCheck:function(t){return t&&t.replace(/^(\d{4})(\d{2})$/,"$1-$2")||""},uploadSuccess:function(t){var a=this;0===t.status?(a.dataId=t.data,n.default.getGrid({dataId:t.data,success:function(t){a.spinShow=!1;var e=t.data;if(t){for(var n=[{key:"errorMsg",title:"提示信息",minWidth:160,align:"center"}],o=0;o<e.columnName.length;o++)n.push({key:e.columnCode[o],title:e.columnName[o],minWidth:120});a.table.tableColumns1=[].concat(n),a.table.data=[].concat(i(e.data)),a.table.totalNum=e.totalNum,a.table.totalBonus=e.totalBonus,a.table.percentage=e.percentage,a.table.uncoveringTotalNum=e.uncoveringTotalNum,a.table.uncoveringTotalBonus=e.uncoveringTotalBonus,a.table.grantStartMonthYM=e.grantStartMonthYM,a.table.grantEndMonthYM=e.grantEndMonthYM,a.table.realBatchCodeName=e.realBatchCodeName}},error:function(t){a.spinShow=!1,console.error(t.message)}})):(a.spinShow=!1,this.$Message.info(t.statusText))},uploadError:function(t){this.$Message.error(t.message)},formatErrorUpload:function(){this.$Message.warning("请上传正确的模板")},downTemplateTab:function(){var t=window.location,a=this.form;window.open(t.origin+"/sylla/phr-ui/bonus/template/download?type="+a.type,"_blank")},formatForm:function(){var t=this.form;t.grantStartMonth=new Date(t.grantStartMonth).format("yyyy-MM"),t.grantEndMonth=new Date(t.grantEndMonth).format("yyyy-MM");var a=[];for(var e in t){if("monthShare"!=e&&"multiSalary"!=e||a.push(encodeURIComponent(e)+"="+encodeURIComponent(0==t[e]?"2":"1")),"rewardName"===e){var n=t[e]?encodeURIComponent("_"+t[e]):t[e];a.push(encodeURIComponent(e)+"="+encodeURIComponent(t.rewardNameVal)+n)}"monthShare"!==e&&"multiSalary"!==e&&"rewardName"!==e&&a.push(encodeURIComponent(e)+"="+encodeURIComponent(t[e]))}return a.join("&")},exportBonus:function(){var t=window.location;this.dataId&&window.open(t.origin+"/sylla/phr-ui/bonus/import/download?dataId="+this.dataId+"&"+this.formatForm(),"_blank")},confirmTab:function(){this.$refs.information.modal6=!0},asyncConfigOK:function(){var t=this,a=this.form;t.spinShow=!0,a.dataId=t.dataId||"",n.default.confirmSubmit({data:a,success:function(a){if(t.spinShow=!1,0===a.status){var e=utils.number_format({decimals:2,number:t.table.totalBonus,dec_point:".",thousands_sep:","});t.$Modal.success({title:"提示信息",content:'导入成功，<br/>已成功导入<code style="color:red">'+t.table.totalNum+'</code>个员工，奖金总额<code style="color:red">'+e+'</code>元。\n              <br/><code style="color:red">请前往【奖金审批】，新增奖金审批工单</code>'}),t.clearTable()}else t.$Modal.error({title:"提示信息",content:"导入失败，原因为："+a.statusText+"。请联系开发人员处理。"})},error:function(a){t.spinShow=!1,t.$Modal.error({title:"提示信息",content:"导入失败，原因为："+a.statusText+"。请联系开发人员处理。"})}})}}}},60:function(t,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default={props:{dataInfo:{type:Object,default:function(){return{}}},rewardName:{type:String,default:""}},data:function(){return{modal6:!1,loading:!1}},methods:{asyncOK:function(){this.$emit("on-ok")},asyncCancel:function(){this.$emit("on-cancel")}}}},92:function(t,a,e){var n=e(93);"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);(0,e(6).default)("fa68d8ea",n,!1,{})},93:function(t,a,e){(t.exports=e(1)(!1)).push([t.i,'\n.batch {\n  cursor: pointer;\n}\n.batch .formItem {\n  padding: 6px 12px;\n  margin: 0px auto;\n}\n.batch .required .ivu-form-item-label:before {\n  content: "*";\n  color: red;\n  font-weight: bold;\n}\n.batch .requiredError .ivu-select-selection,\n.batch .requiredError .ivu-input {\n  border: 1px solid #ffd0ce;\n}\n.batch .btns {\n  display: flex;\n  display: -webkit-box;\n}\n.batch .btns .importLog {\n  margin-left: 16px;\n}\n.batch .downBtns {\n  padding: 6px 12px;\n  margin: 0;\n}\n.batch-table {\n  margin-top: 12px;\n}\n.batch-table th {\n  font-size: 12px;\n}\n.batch-table td {\n  font-size: 12px;\n}\n.batch-table .export {\n  position: absolute;\n  right: 0;\n  top: -30px;\n}\n.batch-table .moneyCount {\n  width: calc(100% - 190px);\n  margin-bottom: 18px;\n  color: #222222;\n  font-size: 12px;\n}\n.batch-table .moneyCount span {\n  color: red;\n}\n.batch-table .preprocessing {\n  color: #999999;\n  font-size: 14px;\n  margin-bottom: 12px;\n}\n.batch .ivu-table .demo-table-error-row td {\n  background-color: rgba(241, 67, 67, 0.5);\n  color: #fff;\n}\n.batch .ivu-table .demo-table-info-row td {\n  background-color: #2db7f5;\n  color: #fff;\n}\n.batch .red {\n  color: red;\n  font-size: 14px;\n  font-family: sans-serif;\n}\n.batch .redFont {\n  color: red;\n}\n.batch .ff6600 td {\n  background-color: #f5f1c6;\n  color: #333333;\n}\n.ivu-message {\n  top: 62px !important;\n}\n',""])},94:function(t,a,e){"use strict";e.r(a);var n=e(60),o=e.n(n);for(var r in n)"default"!==r&&function(t){e.d(a,t,function(){return n[t]})}(r);var s=e(97),i=e(0),l=!1;var c=function(t){l||e(95)},u=Object(i.a)(o.a,s.a,s.b,!1,c,null,null);u.options.__file="src\\page\\bonus\\batch\\component\\information.vue",a.default=u.exports},95:function(t,a,e){var n=e(96);"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);(0,e(6).default)("7ce69e76",n,!1,{})},96:function(t,a,e){(t.exports=e(1)(!1)).push([t.i,"\n.batchToast div {\n  margin-bottom: 5px;\n}\n.batchToast code {\n  color: red;\n}\n",""])},97:function(t,a,e){"use strict";e.d(a,"a",function(){return n}),e.d(a,"b",function(){return o});var n=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("Modal",{attrs:{loading:t.loading,"mask-closable":!1,title:"提示信息","on-cancel":"asyncCancel"},on:{"on-ok":t.asyncOK},model:{value:t.modal6,callback:function(a){t.modal6=a},expression:"modal6"}},[e("article",{staticClass:"batchToast"},[e("div",[t._v("总人数： "),e("code",[t._v(t._s(t.dataInfo.totalNum))]),t._v(" 人；")]),t._v(" "),e("div",[t._v("总金额： "),e("code",[t._v(t._s(t._f("formatMoney")(t.dataInfo.totalBonus,2)))]),t._v(" 元；")]),t._v(" "),void 0!=t.dataInfo.uncoveringTotalNum?e("div",[t._v("其中分拆人数： "),e("code",[t._v(t._s(t.dataInfo.uncoveringTotalNum))]),t._v(" 人；")]):t._e(),t._v(" "),void 0!=t.dataInfo.uncoveringTotalBonus?e("div",[t._v("分拆金额： "),e("code",[t._v(t._s(t._f("formatMoney")(t.dataInfo.uncoveringTotalBonus,2)))]),t._v(" 元")]):t._e(),t._v(" "),void 0!=t.dataInfo.uncoveringTotalNum||void 0!=t.dataInfo.uncoveringTotalBonus?e("div",[t._v("分拆部分会在年底二次发薪时分摊12个月计税发放。")]):t._e(),t._v(" "),e("div",[t._v("应发奖金比例： "),e("code",[t._v(t._s(t.dataInfo.percentage))])]),t._v(" "),e("div",[t._v("奖金归属期间： "),e("code",[t._v(t._s(t.dataInfo.realBatchCodeName))])]),t._v(" "),e("div",[t._v("发放开始月： "),e("code",[t._v(t._s(t.dataInfo.grantStartMonthYM))])]),t._v(" "),e("div",[t._v("发放结束月： "),e("code",[t._v(t._s(t.dataInfo.grantEndMonthYM))])]),t._v(" "),e("div",[t._v("确认导入“"),e("code",[t._v(t._s(t.rewardName))]),t._v("”的奖金数据吗？")])])])},o=[];n._withStripped=!0},98:function(t,a,e){"use strict";e.d(a,"a",function(){return n}),e.d(a,"b",function(){return o});var n=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"batch"},[e("Card",[e("Form",{attrs:{"label-width":80}},[e("Row",[e("Col",{attrs:{span:"5"}},[e("FormItem",{staticClass:"formItem required",attrs:{label:"奖金类型"}},[e("Cascader",{class:t.form.bonusType?"":"requiredError",attrs:{required:"",clearable:"",data:t.$store.state.batch.typeitemInfo},on:{"on-change":t.bonustypebatchitemChange},model:{value:t.form.bonusType,callback:function(a){t.$set(t.form,"bonusType",a)},expression:"form.bonusType"}})],1)],1),t._v(" "),e("Col",{attrs:{span:"5"}},[e("FormItem",{staticClass:"formItem required",attrs:{label:"归属期间"}},[e("Select",{class:t.form.batchName?"":"requiredError",attrs:{clearable:"",filterable:""},on:{"on-change":t.bonustypebatchitemInfoChange},model:{value:t.form.batchName,callback:function(a){t.$set(t.form,"batchName",a)},expression:"form.batchName"}},t._l(t.$store.state.batch.typebatchitemInfo,function(a){return e("Option",{key:a.value,attrs:{value:a.text}},[t._v(t._s(a.text))])}))],1)],1),t._v(" "),e("Col",{attrs:{span:"5"}},[e("FormItem",{staticClass:"formItem required",attrs:{label:"部门"}},[e("Select",{class:t.form.deptId?"":"requiredError",attrs:{filterable:""},model:{value:t.form.deptId,callback:function(a){t.$set(t.form,"deptId",a)},expression:"form.deptId"}},t._l(t.$store.state.batch.deptList,function(a){return e("Option",{key:a.value,attrs:{value:a.value}},[t._v(t._s(a.label))])}))],1)],1),t._v(" "),e("Col",{attrs:{span:"5"}},[e("FormItem",{staticClass:"formItem required",attrs:{label:"薪资组"}},[e("Select",{class:t.form.salaryGroup?"":"requiredError",attrs:{filterable:""},on:{"on-change":t.salaryGroupChange},model:{value:t.form.salaryGroup,callback:function(a){t.$set(t.form,"salaryGroup",a)},expression:"form.salaryGroup"}},t._l(t.SALARY_GROUP,function(a){return e("Option",{key:a.value,attrs:{value:a.value}},[t._v(t._s(a.desc))])}))],1)],1)],1),t._v(" "),e("Row",[e("Col",{attrs:{span:"5"}},[e("FormItem",{staticClass:"formItem required",attrs:{label:"发放开始月"}},[e("DatePicker",{class:t.form.grantStartMonth&&"NaN-aN"!=t.form.grantStartMonth?"":"requiredError",staticStyle:{width:"100%"},attrs:{editable:!1,options:t.dateOptions3,type:"month",format:"yyyy-MM",placeholder:t.grantStartMonthDatePicker,size:"default"},on:{"on-open-change":function(a){return t.dateTimeOpenChange(a,"grantStartMonth",t.grantStartMonthDatePicker)}},model:{value:t.form.grantStartMonth,callback:function(a){t.$set(t.form,"grantStartMonth",a)},expression:"form.grantStartMonth"}})],1)],1),t._v(" "),e("Col",{attrs:{span:"5"}},[e("FormItem",{staticClass:"formItem required",attrs:{label:"发放结束月"}},[e("DatePicker",{class:t.form.grantEndMonth&&"NaN-aN"!=t.form.grantEndMonth?"":"requiredError",staticStyle:{width:"100%"},attrs:{editable:!1,options:t.dateOptions4,type:"month",format:"yyyy-MM",placeholder:t.grantEndMonthDatePicker,size:"default"},on:{"on-open-change":function(a){return t.dateTimeOpenChange(a,"grantEndMonth",t.grantStartMonthDatePicker)}},model:{value:t.form.grantEndMonth,callback:function(a){t.$set(t.form,"grantEndMonth",a)},expression:"form.grantEndMonth"}})],1)],1),t._v(" "),e("Col",{attrs:{span:"5"}},[e("FormItem",{staticClass:"downBtns required",attrs:{label:"下载模板"}},[e("Select",{class:t.form.type?"":"requiredError",attrs:{filterable:""},model:{value:t.form.type,callback:function(a){t.$set(t.form,"type",a)},expression:"form.type"}},t._l(t.downTemplate,function(a){return e("Option",{key:a.value,attrs:{value:a.value}},[t._v(t._s(a.label))])}))],1)],1),t._v(" "),e("Col",{staticClass:"downBtns",attrs:{span:"1"}},[e("Button",{attrs:{disabled:!t.form.type,type:"primary"},on:{click:t.downTemplateTab}},[t._v("下载模板")])],1)],1),t._v(" "),e("Row",[e("Col",{attrs:{span:"10"}},[e("FormItem",{staticClass:"formItem",attrs:{label:"奖金名称"}},[e("Input",{attrs:{maxlength:30},model:{value:t.form.rewardName,callback:function(a){t.$set(t.form,"rewardName",a)},expression:"form.rewardName"}},[e("span",{attrs:{slot:"prepend"},slot:"prepend"},[t._v(t._s(t.rewardNameVal)+t._s(t.form.rewardName?"_"+t.form.rewardName:""))])])],1)],1),t._v(" "),e("Col",{attrs:{span:"4"}},[e("CheckboxGroup",{staticClass:"formItem"},[e("Checkbox",{attrs:{label:"全年分摊计税"},model:{value:t.form.monthShare,callback:function(a){t.$set(t.form,"monthShare",a)},expression:"form.monthShare"}}),t._v(" "),e("Checkbox",{attrs:{label:"多次发薪"},model:{value:t.form.multiSalary,callback:function(a){t.$set(t.form,"multiSalary",a)},expression:"form.multiSalary"}})],1)],1),t._v(" "),e("Col",{staticClass:"formItem btns",attrs:{span:"7"}},[e("Button",{staticStyle:{width:"86px"},attrs:{type:"primary"},on:{click:t.importPreview}},[t._v("导入")]),t._v(" "),e("Upload",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"upload",attrs:{action:t.actionUpload,"show-upload-list":!1,format:["xls","xlsx"],"on-format-error":t.formatErrorUpload,data:t.form,"on-progress":t.onProgress,"on-success":t.uploadSuccess,"on-error":t.uploadError}}),t._v(" "),e("router-link",{attrs:{to:{path:"/hr/bonus/batch/index/log"}}},[e("Button",{staticStyle:{"margin-left":"16px"},attrs:{type:"primary"}},[t._v("导入日志")])],1)],1)],1)],1)],1),t._v(" "),e("Card",{staticClass:"batch-table"},[e("Row",[e("Col",{staticClass:"preprocessing",attrs:{span:"4"}},[t._v("预处理结果")])],1),t._v(" "),e("Row",[t.isImport?e("Col",{staticClass:"moneyCount"},[t._v("\n      共导入员工\n      "),e("span",[t._v(t._s(t.table.totalNum))]),t._v("个，奖金总额\n      "),e("span",[t._v(t._s(t._f("formatMoney")(t.table.totalBonus,2)))]),t._v("元，\n      分拆总金额："),e("span",[t._v(t._s(t._f("formatMoney")(t.table.uncoveringTotalBonus,2)))]),t._v("元\n      "),t.table.percentage?e("code",[t._v("，应发奖金比例为："),e("span",[t._v(t._s(t.table.percentage))]),t._v(".")]):t._e()]):t._e(),t._v(" "),e("Col",{staticClass:"export"},[e("Button",{attrs:{disabled:!t.isImport,type:"primary"},on:{click:t.exportBonus}},[t._v("预览奖金结果")]),t._v(" "),e("Button",{staticStyle:{width:"86px"},attrs:{disabled:t.isShowimport,type:"primary"},on:{click:t.confirmTab}},[t._v("提交")])],1)],1),t._v(" "),e("Row",[e("Table",{ref:"table",attrs:{"row-class-name":t.rowClassName,columns:t.table.tableColumns1,data:t.table.data,height:"530"}})],1)],1),t._v(" "),t.spinShow?e("Spin",{attrs:{size:"large",fix:""}}):t._e(),t._v(" "),e("Information",{ref:"information",attrs:{"reward-name":t.form.rewardNameVal+(t.form.rewardName?"_"+t.form.rewardName:""),"data-info":t.table},on:{"on-ok":t.asyncConfigOK}})],1)},o=[];n._withStripped=!0}}]);
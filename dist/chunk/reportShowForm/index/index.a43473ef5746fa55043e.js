(window.webpackJsonpso=window.webpackJsonpso||[]).push([[10],{157:function(t,a,n){var e=n(158);"string"==typeof e&&(e=[[t.i,e,""]]),e.locals&&(t.exports=e.locals);(0,n(6).default)("1b164e20",e,!1,{})},158:function(t,a,n){(t.exports=n(1)(!1)).push([t.i,"\n.allocation {\n  padding: 12px;\n}\n.allocation .formItem {\n  width: 900px;\n  margin: 2% 0 0 2%;\n}\n.allocation .tableList {\n  position: relative;\n}\n.allocation .tableList .addItem {\n  position: absolute;\n  z-index: 1;\n  right: 112px;\n  top: 9px;\n  background: #ffffff;\n}\n",""])},159:function(t,a,n){"use strict";n.d(a,"a",function(){return e}),n.d(a,"b",function(){return r});var e=function(){var t=this,a=t.$createElement,n=t._self._c||a;return n("XFrame",{staticClass:"allocation"},[n("Form",{ref:"allocationFormDynamic",staticClass:"formItem",attrs:{model:t.formDynamic,"label-width":80}},[n("Card",[n("Row",[n("Col",{attrs:{span:"8"}},[n("FormItem",{attrs:{label:"批次"}},[n("Select",{model:{value:t.model2,callback:function(a){t.model2=a},expression:"model2"}},[n("Option",{attrs:{value:"1"}},[t._v("1")]),t._v(" "),n("Option",{attrs:{value:"2"}},[t._v("2")])],1)],1)],1),t._v(" "),n("Col",{attrs:{span:"8",align:"center"}},[n("Button",{attrs:{disabled:!t.model2||t.formDynamic.data2.length<=0,type:"primary"},on:{click:t.exportReport}},[t._v("导出报表")])],1)],1),t._v(" "),n("Row",{staticClass:"tableList"},[n("Button",{staticClass:"addItem",attrs:{disabled:!t.salaryGroupFlag||!t.salaryMonthFlag,type:"dashed",icon:"plus-round"},on:{click:t.addItem}}),t._v(" "),n("Table",{attrs:{columns:t.formDynamic.columns1,data:t.formDynamic.data2,border:"",height:"600"}})],1)],1)],1),t._v(" "),t.loaddingSpinShow?n("Spin",{attrs:{size:"large",fix:""}}):t._e()],1)},r=[];e._withStripped=!0},52:function(t,a,n){"use strict";n.r(a);var e=n(76),r=n.n(e);for(var o in e)"default"!==o&&function(t){n.d(a,t,function(){return e[t]})}(o);var i=n(159),s=n(0),l=!1;var c=function(t){l||n(157)},d=Object(s.a)(r.a,i.a,i.b,!1,c,null,null);d.options.__file="src\\page\\bonus\\reportShowForm\\index.vue",a.default=d.exports},76:function(t,a,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var e=function(t){return t&&t.__esModule?t:{default:t}}(n(15));a.default={data:function(){var t=this;return{loaddingSpinShow:!1,model2:"",salaryGroupFlag:!1,salaryMonthFlag:!1,formDynamic:{dictList:[],data2:[{salaryGroup:"",salaryMonth:"",action:""}],ruleValidate:{date:[{required:!0,type:"date",message:"请选择月份",trigger:"change"}],name:[{required:!0,type:"string",message:"请选择薪资组",trigger:"blur"}]},columns1:[{title:"薪酬组",key:"salaryGroup",align:"center",width:300,render:function(a,n){var e=t,r=t.formDynamic.dictList,o=[];return r&&r.map(function(t,n){o.push(a("Option",{props:{value:t.value,label:t.desc,key:n}},t.desc))}),a("FormItem",{props:{prop:"data2."+n.index+".salaryGroup",rules:e.formDynamic.ruleValidate.name},style:{marginLeft:"-80px",paddingTop:"10px"}},[a("Select",{props:{value:n.row.salaryGroup||"",transfer:!0},style:{width:"90%"},on:{"on-change":function(t){t&&(e.$set(e.formDynamic.data2[n.index],"salaryGroup",t),e.salaryGroupFlag=!0)}}},o)])}},{title:"月份",key:"salaryMonth",align:"center",width:300,render:function(a,n){var e=t;return a("FormItem",{props:{prop:"data2."+n.index+".salaryMonth",rules:e.formDynamic.ruleValidate.date},style:{marginLeft:"-80px",paddingTop:"10px"}},[a("DatePicker",{props:{type:"month",editable:!1,placeholder:"请选择",value:n.row.salaryMonth||"",transfer:!0,clearable:!1},style:{width:"90%"},on:{"on-change":function(t){t&&(t=new Date(t),e.$set(e.formDynamic.data2[n.index],"salaryMonth",t),e.salaryMonthFlag=!0)}}})])}},{title:" ",key:"action",align:"center",render:function(a,n){return a("div",[a("Button",{props:{type:"dashed",icon:"minus-round",disabled:t.formDynamic.data2.length<=1},on:{click:function(){t.remove(n.index)}}},"")])}}]}}},watch:{"$store.state.com.dictList":function(t){this.formDynamic.dictList=[].concat(function(t){if(Array.isArray(t)){for(var a=0,n=Array(t.length);a<t.length;a++)n[a]=t[a];return n}return Array.from(t)}(t))||[]},"formDynamic.data2":function(t){}},beforeCreate:function(){this.$store.dispatch("getDictionaries","SALARY_GROUP")},mounted:function(){},methods:{addItem:function(){this.jsonFormat()&&this.salaryGroupFlag&&this.salaryMonthFlag&&(this.formDynamic.data2.push({salaryGroup:"",salaryMonth:"",action:""}),this.salaryGroupFlag=!1,this.salaryMonthFlag=!1)},jsonFormat:function(){for(var t=!0,a=this.formDynamic.data2,n=[a[0]],e=1;e<a.length;e++){for(var r=a[e],o=!1,i=0;i<n.length;i++){var s=new Date(r.salaryMonth).getTime(),l=new Date(n[i].salaryMonth).getTime();if(r.salaryGroup==n[i].salaryGroup&&s==l){o=!0;break}}o?(t=!1,this.$Message.warning("第"+(e+1)+"行，数据不可重复")):n.push(r)}return t},remove:function(t){this.formDynamic.data2.splice(t,1),this.jsonFormat()&&this.formDynamic.data2.length<=1&&(this.salaryGroupFlag=!0,this.salaryMonthFlag=!0)},appendQuery:function(t){var a=[];for(var n in t)a.push(encodeURIComponent(n)+"="+encodeURIComponent(t[n]));return a.join("&")},exportReport:function(){var t=!1,a=this;this.jsonFormat()&&(this.$refs.allocationFormDynamic.validate(function(a){t=a}),t&&(a.loaddingSpinShow=!0,e.default.reportShowCheck({data:{item:a.formDynamic.data2,multiSalary:a.model2},success:function(t){if("0"==t.status){var n=a.appendQuery(t.param);return a.sendDown([utils.url.curr+"/sylla/phr-ui/bonus/showreport/export?"+n],function(t){a.loaddingSpinShow=!1})}return a.loaddingSpinShow=!1,a.$Modal.warning({title:"提示信息",content:t.statusText||""})},error:function(t){a.loaddingSpinShow=!1,console.error(t)}})))},sendDown:function(t,a){var n=this,e=Promise.resolve();return t.forEach(function(t){e=e.then(function(){return n.downFile(t,a)})}),e},downFile:function(t,a){var n="";return new Promise(function(a,e){t.substring(t.lastIndexOf("/")+1).split("?")[0],(n=new XMLHttpRequest).onload=function(){a(n)},n.onerror=e,n.open("GET",t);try{n.responseType="arraybuffer"}catch(t){console.error(t)}n.send()}).then(function(t){var n=new Blob([t.response],{type:"application/vnd.ms-excel"});if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(n,"奖金发放日志预览报表.xlsx");else{var e=window.URL.createObjectURL(n),r=document.createElement("a");r.href=e,r.download="奖金发放日志预览报表.xlsx",document.body.appendChild(r),r.click()}return a&&a(t)})}}}}}]);